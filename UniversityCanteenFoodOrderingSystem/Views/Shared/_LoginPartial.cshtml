@using Microsoft.AspNetCore.Identity
@using UniversityCanteenFoodOrderingSystem.Areas.Identity.Data
@using UniversityCanteenFoodOrderingSystem.Helpers
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
	var currentUser = await UserManager.GetUserAsync(User);
}

<ul class="navbar-nav mx-lg-3 ">
    @if (SignInManager.IsSignedIn(User) && currentUser != null)
{
        <!-- Orders link -->
        <li class="nav-item mx-3 text-white">
            <a class="nav-link" asp-controller="Home" asp-action="Orders">
                <i class="bi bi-receipt fs-4"></i>
            </a>
        </li>
        
        <li class="nav-item mx-3 text-white">
            <a class="nav-link position-relative" asp-controller="Home" asp-action="Cart">
                <i class="bi bi-cart fs-4"></i>
                <span class="position-absolute top-3 start-100 translate-middle badge rounded-pill bg-danger">
                    @(HttpContextAccessor.HttpContext.Session.GetObjectFromJson<List<CartItem>>("Cart")?.Count ?? 0)
                </span>
            </a>
        </li>

        <li class="nav-item mx-3">
            <a id="manage" class="nav-link text-white" asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">Hello @currentUser.FullName</a>
        </li>

        <li class="nav-item"> 
            <a class="nav-link" asp-controller="Profile" asp-action="Details"> 
                <i class="bi bi-person-circle"></i> Profile </a> 
        </li>

        <li class="nav-item mx-3">
        <form id="logoutForm" class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("/Account/Login", new { area = "Identity" })">
                <button id="logout" type="submit" class="nav-link btn btn-link text-white border-0">Logout</button>
        </form>
        </li>
}
else
{
        <li class="nav-item mx-3">
            <a class="nav-link text-white" id="register" asp-area="Identity" asp-page="/Account/Register">Register</a>
    </li>
        <li class="nav-item mx-3">
            <a class="nav-link text-white" id="login" asp-area="Identity" asp-page="/Account/Login">Login</a>
    </li>
}
</ul>
